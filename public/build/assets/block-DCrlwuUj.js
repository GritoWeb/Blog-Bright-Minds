const S=wp.blocks.registerBlockType,T=wp.blockEditor.useBlockProps,x=wp.components.SelectControl,s=wp.apiFetch,E=wp.element.useState,D=wp.element.useEffect;S("meutema/post-block",{title:"Post Block",icon:"admin-post",category:"layout",description:"Bloco que mostra dois posts lado a lado. Escolha os posts a serem exibidos.",attributes:{leftPostId:{type:"number",default:0},leftTitle:{type:"string",default:""},leftDate:{type:"string",default:""},leftExcerpt:{type:"string",default:""},leftImageUrl:{type:"string",default:""},leftPostUrl:{type:"string",default:""},rightPostId:{type:"number",default:0},rightTitle:{type:"string",default:""},rightDate:{type:"string",default:""},rightExcerpt:{type:"string",default:""},rightImageUrl:{type:"string",default:""},rightPostUrl:{type:"string",default:""}},supports:{html:!1},edit({attributes:c,setAttributes:l}){const{leftPostId:v,leftTitle:y,leftDate:b,leftExcerpt:w,leftImageUrl:i,leftPostUrl:B,rightPostId:P,rightTitle:R,rightDate:N,rightExcerpt:k,rightImageUrl:o,rightPostUrl:L}=c,U=T({className:"post-block w-full"}),[r,n]=E([]),[d,m]=E(!0);D(()=>{let t=!0;return m(!0),s({path:"/wp/v2/posts?per_page=50&_fields=id,title,excerpt,date,featured_media,link"}).then(a=>{if(!t)return;const g=a.map(e=>({value:e.id,label:e.title&&e.title.rendered?e.title.rendered:`Post ${e.id}`,raw:e}));n(g)}).catch(()=>n([])).finally(()=>t&&m(!1)),()=>{t=!1}},[]);const _=t=>t?s({path:`/wp/v2/media/${t}?_fields=media_details,source_url`}).then(a=>a.source_url).catch(()=>null):Promise.resolve(null),p=async(t,a)=>{var h;if(!a){l(t==="left"?{leftPostId:0,leftTitle:"",leftExcerpt:"",leftDate:"",leftImageUrl:"",leftPostUrl:""}:{rightPostId:0,rightTitle:"",rightExcerpt:"",rightDate:"",rightImageUrl:"",rightPostUrl:""});return}const e=((h=r.find(I=>I.value===a))==null?void 0:h.raw)||await s({path:`/wp/v2/posts/${a}?_fields=id,title,excerpt,date,featured_media,link`}),u=e.featured_media?await _(e.featured_media):"";l(t==="left"?{leftPostId:e.id,leftTitle:e.title&&e.title.rendered?e.title.rendered:"",leftExcerpt:e.excerpt&&e.excerpt.rendered?f(e.excerpt.rendered):"",leftDate:e.date?new Date(e.date).toLocaleDateString():"",leftImageUrl:u||"",leftPostUrl:e.link||""}:{rightPostId:e.id,rightTitle:e.title&&e.title.rendered?e.title.rendered:"",rightExcerpt:e.excerpt&&e.excerpt.rendered?f(e.excerpt.rendered):"",rightDate:e.date?new Date(e.date).toLocaleDateString():"",rightImageUrl:u||"",rightPostUrl:e.link||""})},f=t=>t?t.replace(/<[^>]*>/g,""):"";return React.createElement("div",{...U},React.createElement("div",{className:"mx-auto px-4",style:{maxWidth:"1200px"}},React.createElement("div",{className:"post-block__inner flex flex-wrap -mx-4"},React.createElement("div",{className:"post-item post-left w-1/2 px-4"},React.createElement(x,{label:"Selecionar post (esquerda)",value:v,options:[{value:0,label:"— Selecionar —"},...r],onChange:t=>p("left",Number(t)),disabled:d}),React.createElement("div",{className:"post-card border rounded overflow-hidden mt-3"},i?React.createElement("img",{src:i,alt:"",className:"w-full h-48 object-cover"}):React.createElement("div",{className:"w-full h-48 bg-gray-100 flex items-center justify-center"},"Sem imagem"),React.createElement("div",{className:"p-4"},React.createElement("h3",{className:"font-heading text-h4 mb-2",dangerouslySetInnerHTML:{__html:y}}),React.createElement("div",{className:"text-sm text-gray-600 mb-3"},b),React.createElement("p",{className:"text-base text-gray-800 line-clamp-3"},w)),React.createElement("div",{className:"card-link-overlay"}))),React.createElement("div",{className:"post-item post-right w-1/2 px-4"},React.createElement(x,{label:"Selecionar post (direita)",value:P,options:[{value:0,label:"— Selecionar —"},...r],onChange:t=>p("right",Number(t)),disabled:d}),React.createElement("div",{className:"post-card border rounded overflow-hidden mt-3"},o?React.createElement("img",{src:o,alt:"",className:"w-full h-48 object-cover"}):React.createElement("div",{className:"w-full h-48 bg-gray-100 flex items-center justify-center"},"Sem imagem"),React.createElement("div",{className:"p-4"},React.createElement("h3",{className:"font-heading text-h4 mb-2",dangerouslySetInnerHTML:{__html:R}}),React.createElement("div",{className:"text-sm text-gray-600 mb-3"},N),React.createElement("p",{className:"text-base text-gray-800 line-clamp-3"},k)),React.createElement("div",{className:"card-link-overlay"}))))))},save({attributes:c}){return null}});
